<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Clinic Patient Entry</title>
  <script type="module">
    // Firebase Config
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, addDoc, serverTimestamp, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBqjaLgabOuFb6k8LIJXovKOZMjtxc3CjU",
      authDomain: "clinicapp-a2f2a.firebaseapp.com",
      projectId: "clinicapp-a2f2a",
      storageBucket: "clinicapp-a2f2a.appspot.com",
      messagingSenderId: "313561643437",
      appId: "1:313561643437:web:194a95f5667928cfe78924",
      measurementId: "G-YB9QF191NY"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth();
    const provider = new GoogleAuthProvider();

    const loginBtn = document.getElementById("loginBtn");
    const userInfo = document.getElementById("userInfo");
    const entrySection = document.getElementById("entrySection");
    const staffNameField = document.getElementById("staffName");
    const staffDesigField = document.getElementById("staffDesig");

    loginBtn.addEventListener("click", () => {
      signInWithPopup(auth, provider)
        .then(result => {
          const user = result.user;
          userInfo.textContent = `Logged in as: ${user.displayName}`;
          staffNameField.value = user.displayName;
          entrySection.style.display = "block";
        })
        .catch(error => alert(error.message));
    });

    const form = document.getElementById("entryForm");
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const data = {
        date: new Date().toLocaleDateString(),
        staffName: staffNameField.value,
        designation: staffDesigField.value,
        patientName: form.patientName.value,
        pcName: form.pcName.value,
        pcCode: form.pcCode.value,
        doctorName: form.doctorName.value,
        newPatient: form.newPatient.value,
        oldPatient: form.oldPatient.value,
        testAmount: form.testAmount.value,
        ot: form.ot.value,
        otAmount: form.otAmount.value,
        createdAt: serverTimestamp(),
      };
      if (!data.patientName || (!data.newPatient && !data.oldPatient)) {
        alert("Please fill required fields.");
        return;
      }
      await addDoc(collection(db, "patientEntries"), data);
      form.reset();
    });

    const tableBody = document.getElementById("dataBody");
    onSnapshot(query(collection(db, "patientEntries"), orderBy("createdAt", "desc")), (snapshot) => {
      tableBody.innerHTML = "";
      snapshot.forEach(doc => {
        const d = doc.data();
        const row = `<tr>
          <td>${d.newPatient || ""}</td>
          <td>${d.oldPatient || ""}</td>
          <td>${d.testAmount || ""}</td>
          <td>${d.ot || ""}</td>
          <td>${d.otAmount || ""}</td>
        </tr>`;
        tableBody.innerHTML += row;
      });
    });
  </script>
  <style>
    body { font-family: Arial; background: #001f8d; color: white; margin: 0; padding: 20px; }
    .box { background: #0033cc; padding: 20px; border-radius: 10px; }
    input, select, button { padding: 8px; margin: 5px; width: 90%; max-width: 300px; border-radius: 5px; }
    table { width: 100%; margin-top: 20px; background: white; color: black; border-collapse: collapse; }
    th, td { border: 1px solid #ccc; padding: 10px; text-align: center; }
    #entrySection { display: none; }
  </style>
</head>
<body>
  <h1>Clinic Patient Entry</h1>
  <button id="loginBtn">Login with Google</button>
  <div id="userInfo"></div>

  <div id="entrySection">
    <div class="box">
      <form id="entryForm">
        <input id="staffName" name="staffName" placeholder="Staff Name" readonly><br>
        <select id="staffDesig" name="staffDesig" required>
          <option value="">Select Designation</option>
          <option value="Marketing">Marketing</option>
          <option value="Reception">Reception</option>
          <option value="Attendance">Attendance</option>
          <option value="Collection and Lab">Collection and Lab</option>
          <option value="Others">Others</option>
        </select><br>
        <input name="patientName" placeholder="Patient Name" required><br>
        <input name="pcName" placeholder="PC Name"><br>
        <input name="pcCode" placeholder="PC Code"><br>
        <input name="doctorName" placeholder="Doctor Name"><br>
        <input name="newPatient" placeholder="New"><br>
        <input name="oldPatient" placeholder="Old"><br>
        <input name="testAmount" placeholder="Amount of Test"><br>
        <input name="ot" placeholder="OT"><br>
        <input name="otAmount" placeholder="OT Amount"><br>
        <button type="submit">Submit</button>
        <button type="reset">Clear</button>
      </form>
    </div>

    <table>
      <thead>
        <tr><th>New</th><th>Old</th><th>Amount of Test</th><th>OT</th><th>OT Amount</th></tr>
      </thead>
      <tbody id="dataBody"></tbody>
    </table>
  </div>
</body>
</html>
